<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Capture projects per profile, score them with RICE (reach, impact, confidence, effort) and optional financial impact, and auto-rank by priority—all in the browser." />
  <title>Product Management Prioritization Tool</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link href="css/main.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="app-title-group">
        <span class="app-badge">Product Management Prioritization • Portfolio ready</span>
        <div class="app-title-row">
          <h2 class="app-title">Product Management Prioritization Tool</h2>
          <div class="product-description-wrapper">
            <button type="button" class="rice-info-btn product-description-btn" id="productDescriptionBtn" aria-label="Product description">?</button>
            <div class="product-description-popup rice-popup" id="productDescriptionPopup" role="tooltip">
              <div class="product-description-popup-title">Product Description</div>
              <p class="product-description-popup-body">Capture projects per profile, score them with RICE (reach, impact, confidence, effort) and optional financial impact, and auto-rank by priority—all in the browser.</p>
            </div>
          </div>
        </div>
      </div>
      <div class="app-header-actions">
        <div class="app-header-actions-row">
          <div class="data-pill-group">
            <span class="data-pill-label">Export</span>
            <button type="button" id="exportDataBtn" class="data-pill-btn">
              Export data
            </button>
          </div>
          <div class="data-pill-group">
            <span class="data-pill-label">Import</span>
            <button type="button" id="importDataBtn" class="data-pill-btn">
              Import data
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="app-layout">
      <!-- Profiles / owners -->
      <section class="card profiles-panel">
        <div class="card-header">
          <div>
            <h3 class="card-title">Profiles / Owners</h3>
            <p class="card-caption">Create separate portfolios for different owners, teams, or products.</p>
          </div>
        </div>

        <form id="addProfileForm" class="profile-form-row" autocomplete="off">
          <div class="profile-form-field">
            <label for="newProfileName">Profile name</label>
            <input id="newProfileName" name="newProfileName" type="text" placeholder="e.g. Product Squad Alpha" required />
          </div>
          <div class="profile-form-field">
            <label for="newProfileTeam">Team (optional)</label>
            <input id="newProfileTeam" name="newProfileTeam" type="text" placeholder="e.g. Growth, Core PM, Platform" />
          </div>
          <div class="profile-icon-wrap">
            <button type="submit" class="profile-add-btn" aria-label="Add profile">
              <svg class="profile-add-btn-icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
              <span class="profile-add-btn-text">Add</span>
            </button>
            <div class="cell-type-tooltip">
              <div class="cell-type-tooltip-title">Add profile</div>
              <div class="cell-type-tooltip-body">Create a new profile to organize projects.</div>
            </div>
          </div>
        </form>

        <ul id="profileList" class="profiles-list" aria-label="Profiles list"></ul>
        <p id="profilesEmptyState" class="profile-empty" style="display:none;">No profiles yet. Create your first profile above.</p>
      </section>

      <!-- Projects side -->
      <section class="card-plain">
        <div class="projects-header-row">
          <div class="projects-header-left">
            <div class="projects-header-title" id="activeProfileTitleText">No profile selected</div>
            <div class="projects-header-subtitle" id="activeProfileSubtitleText">
              Create a profile on the left to start prioritizing projects.
            </div>
            <div class="projects-header-badges" id="projectsHeaderBadges"></div>
          </div>
          <div class="projects-header-actions">
            <div class="view-toggle-group" role="tablist" aria-label="Projects view">
              <button type="button" id="projectsViewTableBtn" class="view-toggle-btn view-toggle-btn--active" role="tab" aria-selected="true" data-view="table">Table</button>
              <button type="button" id="projectsViewBoardBtn" class="view-toggle-btn" role="tab" aria-selected="false" data-view="board">Board</button>
              <button type="button" id="projectsViewMoscowBtn" class="view-toggle-btn" role="tab" aria-selected="false" data-view="moscow">MOSCOW</button>
              <button type="button" id="projectsViewMapBtn" class="view-toggle-btn" role="tab" aria-selected="false" data-view="map">Map</button>
            </div>
            <button type="button" id="addProjectBtn" disabled>
              + Project
            </button>
            <button type="button" id="bulkDeleteBtn" class="btn-danger" disabled>
              Delete Selected
            </button>
          </div>
        </div>

        <section class="filters-shell" aria-label="Project filters">
          <div class="filters-header">
            <div>
              <div class="filters-title">Filters</div>
              <div class="filters-quick-label">Tune what’s visible in your table and board.</div>
            </div>
            <div class="filters-meta">
              <span id="filtersActivePill" class="filters-active-pill" style="display:none;"></span>
              <button type="button" id="filtersResetBtn" class="filters-reset-btn">
                Reset
              </button>
              <button type="button" id="filtersToggleBtn" class="filters-toggle-btn">
                Show advanced
              </button>
            </div>
          </div>

          <div class="filters-row">
            <div class="filter-group filter-group--stretch">
              <label for="filterTitle">Project title</label>
              <input id="filterTitle" type="text" placeholder="Search by title..." />
            </div>
            <div class="filter-group filter-group--compact">
              <label for="filterProjectType">Project type</label>
              <select id="filterProjectType">
                <option value="">Any</option>
                <option value="__none__">Not set</option>
                <option value="New Product">New Product</option>
                <option value="Improvement">Improvement</option>
                <option value="Tech Debt">Tech Debt</option>
                <option value="Market Expansion">Market Expansion</option>
              </select>
            </div>
            <div class="filter-group filter-group--compact">
              <label for="filterCountriesSearch">Countries</label>
              <div class="filter-countries">
                <button type="button" id="filterCountriesToggle" class="filter-countries-toggle">
                  <div id="filterCountriesSummary" class="filter-countries-summary"></div>
                  <span class="filter-countries-toggle-icon">▾</span>
                </button>
                <div id="filterCountriesPopup" class="filter-countries-popup">
                  <input id="filterCountriesSearch" type="text" placeholder="Search countries..." />
                  <div id="filterCountriesList" class="filter-countries-list"></div>
                </div>
              </div>
            </div>
            <div class="filter-group filter-group--compact">
              <label for="filterProjectPeriodSearch">Project period</label>
              <div class="filter-countries filter-periods">
                <button type="button" id="filterProjectPeriodToggle" class="filter-countries-toggle">
                  <div id="filterProjectPeriodSummary" class="filter-countries-summary"></div>
                  <span class="filter-countries-toggle-icon">▾</span>
                </button>
                <div id="filterProjectPeriodPopup" class="filter-countries-popup">
                  <input
                    id="filterProjectPeriodSearch"
                    type="text"
                    placeholder="Search periods..."
                  />
                  <div id="filterProjectPeriodList" class="filter-countries-list"></div>
                </div>
              </div>
            </div>
          </div>

          <div id="filtersAdvanced" class="filters-advanced">
            <div class="filters-row">
              <div class="filter-group filter-group--compact">
                <label for="filterImpact">Impact</label>
                <select id="filterImpact">
                  <option value="">Any</option>
                  <option value="1">1 – Minimal</option>
                  <option value="2">2 – Low</option>
                  <option value="3">3 – Medium</option>
                  <option value="4">4 – High</option>
                  <option value="5">5 – Massive</option>
                </select>
              </div>
              <div class="filter-group filter-group--compact">
                <label for="filterEffort">Effort</label>
                <select id="filterEffort">
                  <option value="">Any</option>
                  <option value="1">1 – Tiny</option>
                  <option value="2">2 – Small</option>
                  <option value="3">3 – Medium</option>
                  <option value="4">4 – Large</option>
                  <option value="5">5 – Huge</option>
                </select>
              </div>
              <div class="filter-group filter-group--compact">
                <label for="filterCurrency">Currency</label>
                <select id="filterCurrency">
                  <option value="">Any</option>
                </select>
              </div>
              <div class="filter-group filter-group--compact">
                <label for="filterStatus">Status</label>
                <select id="filterStatus">
                  <option value="">Any</option>
                  <option value="Not Started">Not Started</option>
                  <option value="In Progress">In Progress</option>
                  <option value="On Hold">On Hold</option>
                  <option value="Done">Done</option>
                  <option value="Cancelled">Cancelled</option>
                </select>
              </div>
              <div class="filter-group filter-group--compact">
                <label for="filterTshirtSize">T-shirt size</label>
                <select id="filterTshirtSize">
                  <option value="">Any</option>
                  <option value="__none__">Not set</option>
                  <option value="XS">XS</option>
                  <option value="S">S</option>
                  <option value="M">M</option>
                  <option value="L">L</option>
                  <option value="XL">XL</option>
                </select>
              </div>
              <div class="filter-group filter-group--compact">
                <label for="filterMoscow">MOSCOW</label>
                <select id="filterMoscow">
                  <option value="">Any</option>
                  <option value="Must have">Must have</option>
                  <option value="Should have">Should have</option>
                  <option value="Could have">Could have</option>
                  <option value="Won't have">Won't have</option>
                </select>
              </div>
            </div>
          </div>
        </section>

        <div id="projectsTableView" class="projects-view projects-view--table">
        <div class="table-wrapper" aria-label="Projects table">
          <table>
            <thead>
              <tr>
                <th style="width:32px;">
                  <input id="selectAllProjects" type="checkbox" class="checkbox-input" />
                </th>
                <th data-sort-field="title">
                  <button class="sort-button" type="button">
                    <span>Project</span>
                    <span class="sort-indicator">↕</span>
                  </button>
                </th>
                <th data-sort-field="projectType">
                  <button class="sort-button" type="button">
                    <span>Project type</span>
                    <span class="sort-indicator">↕</span>
                  </button>
                </th>
                <th data-sort-field="projectStatus">
                  <button class="sort-button" type="button">
                    <span>Status</span>
                    <span class="sort-indicator">↕</span>
                  </button>
                </th>
                <th>
                  Project period
                </th>
                <th data-sort-field="tshirtSize">
                  <button class="sort-button" type="button">
                    <span>T-shirt size</span>
                    <span class="sort-indicator">↕</span>
                  </button>
                </th>
                <th data-sort-field="moscowCategory">
                  <button class="sort-button" type="button">
                    <span>MOSCOW</span>
                    <span class="sort-indicator">↕</span>
                  </button>
                </th>
                <th data-sort-field="riceScore">
                  <button class="sort-button" type="button">
                    <span>RICE score</span>
                    <span class="sort-indicator">↕</span>
                  </button>
                </th>
                <th>
                  RICE values
                </th>
                <th data-sort-field="financialImpactValue">
                  <button class="sort-button" type="button">
                    <span>Financial impact</span>
                    <span class="sort-indicator">↕</span>
                  </button>
                </th>
                <th data-sort-field="createdAt">
                  <button class="sort-button" type="button">
                    <span>Created</span>
                    <span class="sort-indicator">↕</span>
                  </button>
                </th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="projectsTableBody">
              <tr>
                <td colspan="12" class="empty-state">
                  Select a profile and add your first project to see it here.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        </div>

        <div id="projectsBoardView" class="projects-view projects-view--board" aria-hidden="true" style="display:none;">
          <div class="scrum-board-toolbar">
            <div id="scrumBoardLegend" class="scrum-board-legend" aria-label="Status color legend"></div>
            <label class="scrum-board-sort-toggle" for="scrumBoardSortByRiceToggle">
              <input type="checkbox" id="scrumBoardSortByRiceToggle" checked aria-describedby="scrumBoardSortByRiceLabel" />
              <span id="scrumBoardSortByRiceLabel">Sort by RICE (desc)</span>
            </label>
            <button type="button" id="scrumBoardFullscreenBtn" class="view-fullscreen-btn" aria-label="Expand board to full screen" title="Full screen">
              <svg class="view-fullscreen-icon icon-expand" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
              <svg class="view-fullscreen-icon icon-compress" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="display:none;"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v3a2 2 0 0 1 2 2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>
              <span class="view-fullscreen-label">Full screen</span>
            </button>
          </div>
          <div id="scrumBoardContainer" class="scrum-board" aria-label="Scrum board"></div>
        </div>

        <div id="projectsMapView" class="projects-view projects-view--map" aria-hidden="true" style="display:none;">
          <div class="projects-map-toolbar">
            <label for="projectsMapMetricSelect" class="projects-map-metric-label">Show by</label>
            <select id="projectsMapMetricSelect" class="projects-map-metric-select" aria-label="Map data metric">
              <option value="projects">Number of projects</option>
              <option value="rice">RICE score</option>
            </select>
            <button type="button" id="projectsMapFullscreenBtn" class="projects-map-fullscreen-btn" aria-label="Expand map to full screen" title="Full screen">
              <svg class="projects-map-fullscreen-icon icon-expand" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
              <svg class="projects-map-fullscreen-icon icon-compress" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="display:none;"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v3a2 2 0 0 1 2 2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>
              <span class="projects-map-fullscreen-label">Full screen</span>
            </button>
          </div>
          <div class="projects-map-legend" id="projectsMapLegend" aria-label="Map legend"></div>
          <div id="projectsMapContainer" class="projects-map-container" aria-label="World map of projects by country"></div>
        </div>

        <div id="projectsMoscowView" class="projects-view projects-view--moscow" aria-hidden="true" style="display:none;">
          <header class="moscow-view-header">
            <h3 class="moscow-grid-title">MoSCoW prioritisation</h3>
            <p class="moscow-board-hint">Drag cards between quadrants to change category, or set it in the project form.</p>
            <button type="button" id="moscowFullscreenBtn" class="view-fullscreen-btn moscow-fullscreen-btn" aria-label="Expand MOSCOW view to full screen" title="Full screen">
              <svg class="view-fullscreen-icon icon-expand" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
              <svg class="view-fullscreen-icon icon-compress" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="display:none;"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v3a2 2 0 0 1 2 2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>
              <span class="view-fullscreen-label">Full screen</span>
            </button>
          </header>
          <div id="moscowBoardContainer" class="moscow-grid" aria-label="MOSCOW prioritization grid"></div>
        </div>
      </section>
    </main>
  </div>

  <input
    type="file"
    id="importFileInput"
    accept=".json,application/json,.csv,text/csv"
    style="display:none;"
  />
  <input type="file" id="importCsvFileInput" accept=".csv,text/csv" style="display:none;" />

  <!-- Export format modal -->
  <div id="exportFormatModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="exportFormatModalTitle">
      <header class="modal-header">
        <div class="modal-title-group">
          <h3 id="exportFormatModalTitle" class="modal-title">Export data</h3>
          <p class="modal-subtitle">
            Choose which format you’d like to export your RICE data in.
          </p>
        </div>
      </header>

      <div class="modal-body" style="display:block;">
        <div class="form-row-inline" style="justify-content:flex-end;margin-top:0.25rem;">
          <button type="button" class="btn-secondary" id="exportAsJsonBtn">Export as JSON</button>
          <button type="button" class="btn-secondary" id="exportAsCsvBtn">Export as CSV</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Import format modal -->
  <div id="importFormatModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="importFormatModalTitle">
      <header class="modal-header">
        <div class="modal-title-group">
          <h3 id="importFormatModalTitle" class="modal-title">Import data</h3>
          <p class="modal-subtitle">
            Bring in profiles and projects from a previous export file.
          </p>
        </div>
      </header>

      <div class="modal-body" style="display:block;">
        <p class="modal-subtitle" style="margin-bottom:0.75rem;">
          Select the format of the file you want to import. Data will be merged into your current workspace.
        </p>
        <div class="form-row-inline" style="justify-content:flex-end;">
          <button type="button" class="btn-secondary" id="importAsJsonBtn">Import JSON</button>
          <button type="button" class="btn-secondary" id="importAsCsvBtn">Import CSV</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Project modal -->
  <div id="projectModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="projectModalTitle">
      <header class="modal-header">
        <div class="modal-title-group">
          <h3 id="projectModalTitle" class="modal-title">New project</h3>
          <p id="projectModalSubtitle" class="modal-subtitle">
            Define reach, impact, confidence, effort, and optional financial upside.
          </p>
        </div>
        <button type="button" class="btn-ghost modal-close-btn" id="projectModalCloseBtn">
          Close
        </button>
      </header>

      <form id="projectForm">
        <div class="modal-body">
          <section>
            <div class="form-section">
              <div class="form-section-header">
                <span class="form-section-title">Project overview</span>
              </div>
              <div class="form-grid form-grid-full">
                <div class="project-field-tooltip-wrap">
                  <label for="projectTitle">Title</label>
                  <input id="projectTitle" name="projectTitle" type="text" placeholder="e.g. Onboarding email sequence revamp" required />
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Title</div>
                    <div class="cell-type-tooltip-body">Short name for the project.</div>
                  </div>
                </div>
                <div class="project-field-tooltip-wrap">
                  <label for="projectDescription">Description</label>
                  <textarea id="projectDescription" name="projectDescription" placeholder="Long-form context, goals, and scope for this project."></textarea>
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Description</div>
                    <div class="cell-type-tooltip-body">Long-form context, goals, and scope. Shown in table tooltip.</div>
                  </div>
                </div>
              </div>
              <div class="field-meta-row" id="projectMetaInfo">
                <span><strong>Created:</strong> <span id="projectMetaCreated">—</span></span>
                <span><strong>Last modified:</strong> <span id="projectMetaModified">—</span></span>
                <span><strong>RICE score:</strong> <span id="projectMetaRice">—</span></span>
              </div>
            </div>

            <div class="form-section">
              <div class="form-section-header">
                <span class="form-section-title">RICE inputs</span>
                <span class="form-section-hint">RICE = (Reach × Impact × Confidence) ÷ Effort</span>
              </div>

              <div class="form-grid">
                <div class="project-field-tooltip-wrap">
                  <label for="reachDescription">Reach description</label>
                  <textarea id="reachDescription" name="reachDescription" placeholder="Who will this affect, and over what period?"></textarea>
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Reach description</div>
                    <div class="cell-type-tooltip-body">Who will this affect, and over what period?</div>
                  </div>
                </div>
                <div class="project-field-tooltip-wrap">
                  <label for="reachValue">Reach value (integer)</label>
                  <input id="reachValue" name="reachValue" type="number" min="0" step="1" placeholder="e.g. 1200" required />
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Reach value</div>
                    <div class="cell-type-tooltip-body">Numeric reach (e.g. users or events per quarter). Used in RICE.</div>
                  </div>
                </div>
              </div>

              <div class="form-grid">
                <div class="project-field-tooltip-wrap">
                  <label for="impactDescription">Impact description</label>
                  <textarea id="impactDescription" name="impactDescription" placeholder="How much will this move your core metric per user?"></textarea>
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Impact description</div>
                    <div class="cell-type-tooltip-body">How much this moves your core metric per user.</div>
                  </div>
                </div>
                <div class="project-field-tooltip-wrap">
                  <label for="impactValue">Impact (1–5)</label>
                  <select id="impactValue" name="impactValue" required>
                    <option value="">Select impact</option>
                    <option value="1">1 – Minimal</option>
                    <option value="2">2 – Low</option>
                    <option value="3">3 – Medium</option>
                    <option value="4">4 – High</option>
                    <option value="5">5 – Massive</option>
                  </select>
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Impact (1–5)</div>
                    <div class="cell-type-tooltip-body">1 = Minimal, 5 = Massive. Effect per user. Used in RICE.</div>
                  </div>
                </div>
              </div>

              <div class="form-grid">
                <div class="project-field-tooltip-wrap">
                  <label for="confidenceDescription">Confidence description</label>
                  <textarea id="confidenceDescription" name="confidenceDescription" placeholder="Why do you believe this will work? Link data, experiments, or bets."></textarea>
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Confidence description</div>
                    <div class="cell-type-tooltip-body">Why you believe this will work; link data, experiments, or bets.</div>
                  </div>
                </div>
                <div class="project-field-tooltip-wrap">
                  <label for="confidenceValue">Confidence (% 0–100)</label>
                  <input id="confidenceValue" name="confidenceValue" type="number" min="0" max="100" step="1" placeholder="e.g. 80" required />
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Confidence (% 0–100)</div>
                    <div class="cell-type-tooltip-body">Percentage certainty. Used in RICE (normalized to 0–1 when &gt; 1).</div>
                  </div>
                </div>
              </div>

              <div class="form-grid">
                <div class="project-field-tooltip-wrap">
                  <label for="effortDescription">Effort description</label>
                  <textarea id="effortDescription" name="effortDescription" placeholder="Rough sizing: people × weeks, dependencies, and complexity."></textarea>
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Effort description</div>
                    <div class="cell-type-tooltip-body">Rough sizing: people × weeks, dependencies, and complexity.</div>
                  </div>
                </div>
                <div class="project-field-tooltip-wrap">
                  <label for="effortValue">Effort (1–5)</label>
                  <select id="effortValue" name="effortValue" required>
                    <option value="">Select effort</option>
                    <option value="1">1 – Tiny</option>
                    <option value="2">2 – Small</option>
                    <option value="3">3 – Medium</option>
                    <option value="4">4 – Large</option>
                    <option value="5">5 – Huge</option>
                  </select>
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Effort (1–5)</div>
                    <div class="cell-type-tooltip-body">1 = Tiny, 5 = Huge. Used as divisor in RICE formula.</div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="form-section">
              <div class="form-section-header">
                <span class="form-section-title">Financial impact (optional)</span>
              </div>
              <div class="form-grid">
                <div class="project-field-tooltip-wrap">
                  <label for="financialImpactValue">Financial impact</label>
                  <input id="financialImpactValue" name="financialImpactValue" type="number" min="0" step="0.01" placeholder="e.g. 250000" />
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Financial impact</div>
                    <div class="cell-type-tooltip-body">Optional revenue or cost impact. Not used in RICE score.</div>
                  </div>
                </div>
                <div class="project-field-tooltip-wrap">
                  <label for="projectCurrency">Currency</label>
                  <select id="projectCurrency" name="projectCurrency">
                    <option value="">None / not set</option>
                  </select>
                  <div class="cell-type-tooltip">
                    <div class="cell-type-tooltip-title">Currency</div>
                    <div class="cell-type-tooltip-body">Currency for the financial impact value.</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="form-section-header">
                <span class="form-section-title">Project metadata</span>
              </div>

                <div class="form-grid form-grid-full">
                  <div class="countries-section">
                    <div class="project-field-tooltip-wrap">
                      <label for="projectType">Project type (optional)</label>
                      <select id="projectType" name="projectType">
                        <option value="">—</option>
                        <option value="New Product">New Product</option>
                        <option value="Improvement">Improvement</option>
                        <option value="Tech Debt">Tech Debt</option>
                        <option value="Market Expansion">Market Expansion</option>
                      </select>
                      <div class="cell-type-tooltip">
                        <div class="cell-type-tooltip-title">Project type</div>
                        <div class="cell-type-tooltip-body">Category: New Product, Improvement, Tech Debt, Market Expansion.</div>
                      </div>
                    </div>

                    <div class="project-field-tooltip-wrap" style="margin-top:0.55rem;">
                      <label for="projectStatus">Project status</label>
                      <select id="projectStatus" name="projectStatus">
                        <option value="">—</option>
                        <option value="Not Started">Not Started</option>
                        <option value="In Progress">In Progress</option>
                        <option value="On Hold">On Hold</option>
                        <option value="Done">Done</option>
                        <option value="Cancelled">Cancelled</option>
                      </select>
                      <div class="cell-type-tooltip">
                        <div class="cell-type-tooltip-title">Project status</div>
                        <div class="cell-type-tooltip-body">Current state: Not Started, In Progress, On Hold, Done, or Cancelled.</div>
                      </div>
                    </div>

                    <div class="project-field-tooltip-wrap" style="margin-top:0.55rem;">
                      <label for="projectTshirtSize">T-shirt size</label>
                      <select id="projectTshirtSize" name="projectTshirtSize">
                        <option value="">—</option>
                        <option value="XS">XS</option>
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                      </select>
                      <div class="cell-type-tooltip">
                        <div class="cell-type-tooltip-title">T-shirt size</div>
                        <div class="cell-type-tooltip-body">Relative size from XS to XL for planning.</div>
                      </div>
                    </div>

                    <div class="project-field-tooltip-wrap" style="margin-top:0.55rem;">
                      <label for="projectPeriod">Project period (YYYY-QX)</label>
                      <input
                        id="projectPeriod"
                        name="projectPeriod"
                        type="text"
                        placeholder="e.g. 2026-Q1"
                        pattern="[0-9]{4}-[Qq][1-4]"
                      />
                      <div class="cell-type-tooltip">
                        <div class="cell-type-tooltip-title">Project period</div>
                        <div class="cell-type-tooltip-body">Quarter (e.g. 2026-Q1) for planning and filtering.</div>
                      </div>
                    </div>

                    <div class="project-field-tooltip-wrap" style="margin-top:0.55rem;">
                      <label for="projectMoscow">MOSCOW category</label>
                      <select id="projectMoscow" name="projectMoscow">
                        <option value="">—</option>
                        <option value="Must have">Must have</option>
                        <option value="Should have">Should have</option>
                        <option value="Could have">Could have</option>
                        <option value="Won't have">Won't have</option>
                      </select>
                      <div class="cell-type-tooltip">
                        <div class="cell-type-tooltip-title">MOSCOW category</div>
                        <div class="cell-type-tooltip-body">Must have, Should have, Could have, or Won't have (this time).</div>
                      </div>
                    </div>

                    <div class="project-field-tooltip-wrap" style="margin-top:0.55rem;">
                      <label style="margin-top:0;">Target countries (optional)</label>
                      <div id="countriesContainer" class="countries-list"></div>
                      <button type="button" id="addCountryBtn" class="btn-secondary" style="align-self:flex-start;min-height:32px;font-size:0.72rem;padding-inline:0.6rem;margin-top:0.15rem;">
                        + Add country
                      </button>
                      <div class="cell-type-tooltip">
                        <div class="cell-type-tooltip-title">Target countries</div>
                        <div class="cell-type-tooltip-body">Countries this project applies to. Used for filtering.</div>
                      </div>
                    </div>
                  </div>
                </div>
            </div>

            <div id="projectFormError" class="field-error" role="alert" style="display:none;"></div>

            <div class="form-actions-row">
              <button type="button" class="btn-secondary" id="projectFormCancelBtn">Cancel</button>
              <button type="submit" id="projectFormSubmitBtn">Save project</button>
            </div>
          </section>
        </div>
      </form>
    </div>
  </div>

  <!-- Hidden file inputs used by Import buttons (JSON and CSV) -->
  <input
    type="file"
    id="importFileInput"
    accept=".json,application/json,.csv,text/csv"
    style="display:none;"
  />

  <!-- Profile view modal -->
  <div id="profileViewModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="profileViewModalTitle">
      <header class="modal-header">
        <div class="modal-title-group">
          <h3 id="profileViewModalTitle" class="modal-title">Profile</h3>
          <p id="profileViewModalSubtitle" class="modal-subtitle">Profile and team details.</p>
        </div>
      </header>
      <div class="modal-body" style="display:block;">
        <div class="form-section">
          <div class="form-section-header">
            <span class="form-section-title">Profile &amp; team</span>
          </div>
          <div class="field-meta-row">
            <span><strong>Profile name:</strong> <span id="profileViewName">—</span></span>
            <span><strong>Team:</strong> <span id="profileViewTeam">—</span></span>
          </div>
        </div>
        <div class="form-section profile-view-stats-section">
          <div class="form-section-header">
            <span class="form-section-title">Profile statistics</span>
          </div>
          <div class="profile-view-stats">
            <div class="profile-view-stat-row">
              <span class="profile-view-stat-label">Total unique countries</span>
              <span id="profileViewUniqueCountries" class="profile-view-stat-value">—</span>
            </div>
            <div class="profile-view-stat-row">
              <span class="profile-view-stat-label">Total projects</span>
              <span id="profileViewTotalProjects" class="profile-view-stat-value">—</span>
            </div>
            <div class="profile-view-stat-row profile-view-stat-row-multi">
              <span class="profile-view-stat-label">By status</span>
              <div id="profileViewByStatus" class="profile-view-chips"></div>
            </div>
            <div class="profile-view-stat-row profile-view-stat-row-multi">
              <span class="profile-view-stat-label">By project type</span>
              <div id="profileViewByType" class="profile-view-chips"></div>
            </div>
            <div class="profile-view-stat-row profile-view-stat-row-multi">
              <span class="profile-view-stat-label">By T-shirt size</span>
              <div id="profileViewByTshirt" class="profile-view-chips"></div>
            </div>
            <div class="profile-view-stat-row profile-view-stat-row-multi">
              <span class="profile-view-stat-label">RICE score</span>
              <div id="profileViewRiceStats" class="profile-view-rice"></div>
            </div>
          </div>
        </div>
        <div class="form-actions-row">
          <button type="button" id="profileViewCloseBtnFooter">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile edit modal -->
  <div id="profileEditModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="profileEditModalTitle">
      <header class="modal-header">
        <div class="modal-title-group">
          <h3 id="profileEditModalTitle" class="modal-title">Edit profile</h3>
          <p id="profileEditModalSubtitle" class="modal-subtitle">Update profile name and team.</p>
        </div>
      </header>
      <div class="modal-body" style="display:block;">
        <div class="form-section">
          <div class="form-section-header">
            <span class="form-section-title">Profile &amp; team</span>
          </div>
          <div class="form-grid form-grid-full">
            <div>
              <label for="profileEditName">Profile name</label>
              <input id="profileEditName" type="text" placeholder="Profile name" required />
            </div>
            <div>
              <label for="profileEditTeam">Team</label>
              <input id="profileEditTeam" type="text" placeholder="Team (optional)" />
            </div>
          </div>
        </div>
        <div class="form-actions-row">
          <button type="button" class="btn-secondary" id="profileEditCancelBtn">Cancel</button>
          <button type="button" id="profileEditSaveBtn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile delete confirm modal -->
  <div id="profileDeleteModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="profileDeleteModalTitle">
      <header class="modal-header">
        <div class="modal-title-group">
          <h3 id="profileDeleteModalTitle" class="modal-title">Delete profile</h3>
          <p class="modal-subtitle">
            <span class="modal-subtitle-strong" id="profileDeleteNameLabel"></span>
            <span id="profileDeleteSummaryLabel"></span>
          </p>
        </div>
        <button type="button" class="btn-ghost modal-close-btn" id="profileDeleteCancelTopBtn">
          Cancel
        </button>
      </header>

      <div class="modal-body">
        <p class="modal-subtitle" id="profileDeleteWarningText">
          This will permanently remove this profile and all of its projects from this browser. This action cannot be undone.
        </p>
        <div class="form-actions" style="margin-top:1rem;justify-content:flex-end;">
          <button type="button" class="btn-ghost" id="profileDeleteCancelBtn">Keep profile</button>
          <button type="button" class="btn-danger" id="profileDeleteConfirmBtn">Delete profile</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Project delete confirm modal -->
  <div id="projectDeleteModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="projectDeleteModalTitle">
      <header class="modal-header">
        <div class="modal-title-group">
          <h3 id="projectDeleteModalTitle" class="modal-title">Delete project</h3>
          <p class="modal-subtitle">
            <span class="modal-subtitle-strong" id="projectDeleteNameLabel"></span>
          </p>
        </div>
      </header>

      <div class="modal-body">
        <p class="modal-subtitle" id="projectDeleteWarningText">
          This will permanently remove this project from this profile. This action cannot be undone.
        </p>
        <div class="form-actions">
          <button type="button" class="btn-ghost" id="projectDeleteCancelBtn">Keep project</button>
          <button type="button" class="btn-danger" id="projectDeleteConfirmBtn">Delete project</button>
        </div>
      </div>
    </div>
  </div>

  <div id="toastContainer" class="toast-container" role="status" aria-live="polite" aria-label="Deletion notifications"></div>

  <!-- Classic scripts (no ES modules) so you can just open index.html directly -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="src/constants.js"></script>
  <script src="src/utils.js"></script>
  <script src="src/rice.js"></script>
  <script src="src/app.js"></script>
</body>
</html>

